Sub AggiornaCodiceVBA()
    Dim Http As Object
    Dim vbProj As Object
    Dim vbComp As Object
    Dim ModuloNome As String
    Dim URL As String
    Dim NuovoCodice As String
    Dim sheet As Object

    ' Imposta il riferimento al progetto VBA
    Set vbProj = ThisWorkbook.VBProject

    ' Itera su tutti i moduli VBA
    For Each vbComp In vbProj.VBComponents
        ' Nome del modulo corrente
        ModuloNome = vbComp.Name
        
        ' URL del file su GitHub
        URL = "https://raw.githubusercontent.com/jaupi-enrico/Excel_macros/main/" & ModuloNome & ".txt"
        
        ' Scarica il file
        Set Http = CreateObject("MSXML2.XMLHTTP")
        Http.Open "GET", URL, False
        Http.setRequestHeader "Authorization", "token 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"
        Http.Send

        If Http.Status = 200 Then
            ' Ottieni il codice dal file remoto
            NuovoCodice = Http.responseText
            
            ' Rimuove il BOM UTF-8 se presente
            If Left(NuovoCodice, 3) = ChrW(&HFEFF) Then
                NuovoCodice = Mid(NuovoCodice, 4)
            End If

            ' Sostituisci il codice del modulo
            With vbComp.CodeModule
                .DeleteLines 1, .CountOfLines
                .AddFromString NuovoCodice
            End With
        Else
            MsgBox "Errore nel download del codice! Stato: " & Http.Status, vbCritical
        End If
    Next vbComp

    MsgBox "Codice aggiornato con successo!", vbInformation
End Sub